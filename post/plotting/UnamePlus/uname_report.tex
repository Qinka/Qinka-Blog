\documentclass{ctexart}

\author{李约瀚（Qinka） \\ 14130140331 \\ qinka@live.com \\ qinka@qinka.pw}
\title{Uname Language Report}

\usepackage{listings}
\usepackage{amsmath}

\begin{document}
\maketitle

初版，未整理
\section{概述与版权声明}
\label{sec:copyright}

这个是绘图语言 Uname 的语言报告，基本上是在模仿 Haskell 的语言报告。
这个报告的作者为 李约瀚 \footnote{西安电子科技大学，软件学院，14级本科生。qinka@live.com 与 qinka@qinka.pw 均为本人的邮箱。}

Uname 这个语言是根据2016年 西安电子科技大学软件学院编译原理课程中要求实现的绘图语言，经过可以忽略的修改而来。
语言“原型”相关权利归西安电子科技大学软件学院编译原理授课组与相关人士所有。 Uname 语言的相关内容的所有权归本人（李约瀚）所有。

这个语言及其派生的（如 UnamePlus）的相关内容将遵循类 BSD3 协议的开源协议。但特此在此说明，冒用他人的东西验收学校相关课程及实验属于对
所有权与署名的侵犯。

\section{前言}
\label{sec:preface}

在 西安电子科技大学软件学院 不知到多久以前，编译原理的授课组搞出来一个连名字都没有的绘图语言。
估计数由于太简单了吧，整个语言的语句也没有几个，十分适合本科生学习编译的一些基础知识。
在2016年的这门课程上，我“决定”实例化这个语言原型，并将之命名为 Uname。并且尝试拓展这个语言，来更深入的学习编译原理。
由于没有名字，那就叫 Uname 了。

\subsection{目标}
\label{sec:preface:goals}

\begin{enumerate}
\item 遵循课程中的语言所涉及到的规范
\item 使得语言所需要的解释器变得相对十分简单
\item 语言简洁、稳定
\end{enumerate}

\subsection{编译器}
\label{sec:preface:compiler}

关于编译器，在编写这个报告的时候，还没有开始制作编译器。

\subsection{语言扩展}
\label{sec:preface:extension}

关于语言扩展，将在专门的一节讨论，其中语言扩展的目标与目的是在一定程度上扩展语言，达到 UnamePlus 的预期。
换句话说 UnamePlus 将通过 Uname 的语法扩展实现。而每一类扩展，将组成一个范畴。

\section{导入}
\label{sec:intro}

Uname 是一个及其简单的绘图语言，真的简单的不能再简单了。Uname 的绘图方式也是十分简单的，直接是按像素点绘制的。
给出绘制的参数方程与参数的范围、步长，来画出图形。

这个报告尽可能不与具体的编译器／解释器实现相挂钩。但不能排除会涉及到部分编译器的内容。

\subsection{程序结构}
\label{sec:intro:structure}

Uname 的程序结构相当简单，但是简单的东西往往能作出复杂的事情。原生的 Uname 程序分为两个部分，一个是调整坐标，
也就是坐标的变换。另一个部分就是绘制图形。

就滨湖岸坐标而言，变换只有三个变换，也是最基本的变换：平移，伸缩，与旋转。
绘制图形也是比较简单，一个简单的参数方程。通过简单的迭代，就可以完成，以至于编译器／解释器的实现中，最复杂的可能成为
绘制图形这一部分。

\subsection{语言集合}
\label{sec:intro:langset}

Uname 的语言内容集合，不是简单的一个集合。 Uname/Uname+ 相对来说有一个本质上的集合，暂且我们称之为 Uname Normal Kernel（UNK）。
Uname Normal Kernel 并不是一个最小的完备集合。原生的 Uname 才是一个最小的完备的、满足课程要求的集合。
我们将原生的 Uname 的语言内容组成的集合称之为 Uname Mini Kernel（UMK）。同时我们对于扩展的部分，也就是 UnamePlus，
称之为 Uname Plus Kernel （UPK）。而 Uname 整个语言是有这三个部分组成的。当然，并不是简单的并集关系。
所以这个语言就变成了一个类，而非集合，根据罗素悖论。

具体对于语言集合的内容，将在语言与语法扩展部分，详细说明。

\subsection{语言内容}
\label{sec:intro:lang}

语言的实体部分包括四个部分：坐标变换的设置、绘图、注释、与常用函数。
坐标的三种变换方式将通过“IS”语句说明。绘图则是那唯一的语言。注释则稍有不同，对于 UMK，只有 C-like 的与 Haskell
的 行注释格式。对于 UNK 与 UPK 将有块注释。

\subsection{全局属性设置}
\label{sec:intro:settings}

全局属性设置属关于设置坐标三种变换的一类语句。但是将这一类语句抽象出来，我们定义一类全局设置语句。
定义全局赋值操作符 “IS”或者按照正常区分大小写的“is”。 这个操作符的作用类似于等号。
大致如下：
\begin{lstlisting}
  VARIABLE is VALUE;
\end{lstlisting}

\subsection{绘图}
\label{sec:intro:draw}

按照屏幕的坐标系来绘制给定的参数方程。设定好参数的变化范围与变化的步长。
大致将这个语句分为 三部分，一部分是相当于运算符，一共有三组。

第一组是 \verb|FOR|，为二元前缀运算符（或者称之为函数），接受两个参数，一个是变量名，另一个是对应的离散变化范围，也就是一个数组。
返回的是一个 特殊$\lambda$ 表达式，变量的名称是确定的。

第二组是 \verb|FROM...TO...STEP| 运算符，是通过指定指定 起、止与步长，来产生一个数组。

第三组是 \verb|DRAW| 这是个二元中缀运算符，接受一个特殊的 $\lambda$ 表达式另一个更特殊的$\lambda$ 表达式作为参数。
第一个参数“映射”一系列的参数的值，第二个参数是接受一个参数的实际的值，然后给出一个对应的坐标。
最后返回的内容是不需要的，直接执行 IO 操作，绘制图形，或者传递给后端。再另行处理。

\subsection{注释与常用函数}
\label{sec:intro:commentNfuncs}

注释与常用函数的话，就那样子了。没有什么可以多说的。

\subsection{图形绘制与后端}
\label{sec:intro:drawNbackend}

解释的时候，渲染是使用 GTK 来进行。如果进行编译的话，或使用 Matlab 或者 LaTeX 作为后端。
前端将分析结果转换成中间语言，然后通过后端或者渲染器渲染出来。

% TODO: 使用EBNF重新 来写
\section{词法结构}
\label{sec:lexicalStructure}

这一部分我们将讨论 Uname 的词法结构\footnote{目前仅讨论 UMK 的。}，并且会定义 Uname 的词法结构。

\subsection{符号约定}
\label{sec:lex:nc}

词法与语法的部分是用类似与 EBNF 的方式表达词法结构或者语法结构。其中
\begin{center}
\begin{tabular}{cl}
    $[pattern]$ & optional \\ 
    $\{pattern\}$ & zero or more repetitions \\ 
    $(parttern)$ & grouping\\
    $pat_1|pat_2$ &  choice \\
    $pat_{<pat'>}$ & difference--elements generated by pat\\
     & except those generated by $pat'$ \\
    $\mathtt{fibonacci}$ & terminal syntax in typewriter font
\end{tabular} 
\end{center}

同时还会使用诸如 $[..]$ 之类的方式化简表达式。

\subsection{程序词法结构}
\label{sec:lex:lps}

\begin{flushleft}
\begin{tabular}{lcl}
   \textit{program} & $\rightarrow$  &\{ \textit{lexeme | whitespace} \}\\
   \textit{lexeme} & $\rightarrow$ & \textit{extvarid | ovarid | literal | special} \\
   \textit{literal} & $\rightarrow$ & \textit{float | tuple} \\
   \textit{special} & $\rightarrow$ & \texttt{(|)|,|;|\{|\}} \\
   & &\\
   \textit{whitespace} & $\rightarrow$ & \textit{whitestuff }\{\textit{whitestuff}\} \\
   \textit{whitestuff} & $\rightarrow$ & \textit{whitechar | comment | ncomment} \\
   \textit{whitechar} & $\rightarrow$ & \textit{newline | vertab | space | tab } \\
   \textit{newline} & $\rightarrow$ & \textit{return linefeed | return | linefeed | formfeed} \\
   \textit{return} & $\rightarrow$ & \texttt{a carriage return} \\
   \textit{line feed} & $\rightarrow$ & \texttt{a line feed} \\
   \textit{vertab} & $\rightarrow$ & \texttt{a vertical tab} \\
   \textit{formfeed} & $\rightarrow$ & \texttt{a form feed} \\
   \textit{space} & $\rightarrow$ & \texttt{a space} \\
   \textit{tab} & $\rightarrow$ & \texttt{a horizontal tab} \\
   &&\\
   \textit{comment1} & $\rightarrow$ & $dashes1\,[ any_{<symbol>} {any}]$ \textit{| newline} \\
   \textit{comment2} & $\rightarrow$ & $dashes2\,[ any_{<symbol>} {any}]$ \textit{| newline} \\
   \textit{dashes1} & $\rightarrow$ & \textit{--\{-\}} \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
   & $\rightarrow$ & \\
    & $\rightarrow$ & \\
    & $\rightarrow$ & \\
\end{tabular}
\end{flushleft}

\subsection{基本定义}
\label{sec:lexical:basic}

则有如下基本定义，其中粗体内容表示使用描述方式表示的内容。

定义字母
\begin{align*}
ascLarge &\rightarrow A|B|...|Z \\
ascSmall &\rightarrow a|b|...|z \\
uniLarge &\rightarrow \mathbf{the\,normal\,Unicode\,upper-case\,or\,title-case letter} \\
uniSmall &\rightarrow \mathbf{the\,normal\,Unicode\,lower-case\,letter} \\
large &\rightarrow ascLarge|uniLarge \\
small &\rightarrow ascSmall|uniSmall
\end{align*}

定义数字
\begin{align*}
ascDigit &\rightarrow 0|1|..|9 \\
uniDigit &\rightarrow \mathbf{the\,normal\,Unicode\,decimal\,digit} \\
digit &\rightarrow ascDigit|uniDigit \\
octit &\rightarrow 0|1|..|7 \\
hexit &\rightarrow digit|A|..|F|a|..|f
\end{align*}

定义空白
\begin{align*}
whitechar &\rightarrow newline|\mathbf{a\,vertical\,tab}|space|tab|\mathbf{any\,Unicode\,whitespace} \\
newline &\rightarrow \mathbf{a\,carriage\,return}|\mathbf{return\,linefeed}|\mathbf{linefeed}|\mathbf{formfeed} \\
whitestuff &\rightarrow whitechar|comment|ncomment \\
whitespace &\rightarrow whitestuff^+ \\
space &\rightarrow \mathbf{a\,space} \\
tab &\rightarrow \mathbf{a\,horizontal\,tab}
\end{align*}

定义 注释公共部分
\begin{align*}
dashes1 &\rightarrow --(-)^* \\
dashes2 &\rightarrow //(/)^* \\
opencom1 &\rightarrow \{- \\
closecom1 &\rightarrow -\} \\
opencom2 &\rightarrow /* \\
closecom2 &\rightarrow */ \\
graphic &\rightarrow small|large|symbol|digit|special|"|' \\
any &\rightarrow graphic|space|tab \\
ANY &\rightarrow graphic|whitechar \\
ANYseq1 &\rightarrow ANY^*_{<ANY^*(opencom1|closecom1)>} \\
ANYseq2 &\rightarrow ANY^*_{<ANY^*(opencom2|closecom2)>}
\end{align*}

UMK 的注释部分
\begin{align*}
comment &\rightarrow (dashes1|dashes2)\,any^*\,newline \\
ncomment &\rightarrow \varepsilon
\end{align*}

UNK 与 UPK 的注释
\begin{align*}
comment &\rightarrow (dashes1|dashes2)\,any_{<symbol>}\,any^*\,newline \\
ncomment1 &\rightarrow opencom1\,ANYseq1\,{ncomment1\,ANYseq1}\,closecom1 \\
ncomment2 &\rightarrow opencom2\,ANYseq2\,{ncomment2\,ANYseq2}\,closecom2 \\
ncomment &\rightarrow ncomment1|ncomment2
\end{align*}

定义符号
\begin{align*}
ascSymbol &\rightarrow !|\#|\$|\%|\&|*|+|.|/|<|=|>|?|@|\textbackslash|\^|\||-|~|: \\
uniSymbol &\rightarrow \mathbf{any\,Unicode\,symbol\,or\,punctuation} \\
special &\rightarrow (|)|,|;|[|]|`|\{|\} \\
symbol &\rightarrow ascSymbol|uniSymbol|{<special|\_|'|">} \\
\end{align*}

\subsection{定义字面量与类型}
\label{sec:lexical:lit}
定义数的表示
\begin{align*}
decimal &\rightarrow digit^+ \\
octal &\rightarrow octit^+ \\
hexadecimal &\rightarrow hexit^+ \\
exponent &\rightarrow (e|E)(+|-)?decimal\\
float &\rightarrow decimal(.decimal|.)?(exponent)? \\
      &| .decimal(exponent)?
\end{align*}

定义元组的表示方式
\begin{align*}
tupleItem &\rightarrow float|namedLambda \\
tuple &\rightarrow '()' \\
      &| '('tupleItem')' \\
      &| '('tupleItem,tupleItem')' \\
      &| '('tupleItem,tupleItem,tupleItem')' \\
      &| '('tupleItem,tupleItem,tupleItem,tupleItem')' \\
      &| '('tupleItem,tupleItem,tupleItem,tupleItem,tupleItem')' \\
      &| '('tupleItem,tupleItem,tupleItem,tupleItem,tupleItem,tupleItem')' 
\end{align*}

\subsection{层次}
\label{sec:lexical:layout}
对于 UMK 来说，只有一个层次，而且用过分号分割。

\section{语法与表达式}
\label{sec:exp}
这一部分是关于Uname 的语法部分与表达式的部分。我们使用生成式表示这一部分的语法与表达式结构。
Uname 的语法与表达式也相对来说比较简单。

程序的定义
\begin{align*}
prog &\rightarrow ((langOpt|stmt|cmt)newline)^*stmt\,newline((stmt|cmt)newline)^* \\
langOpt &\rightarrow "\{-\#"(space)?"LANGUAGE"\,space\,langOptItem(space)?"\#-\}" \\
stmt &\rightarrow settingStmt|drawStmt \\
cmt &\rightarrow comment|nocomment
\end{align*}

设置语句的定义
\begin{align*}
settingStmt &\rightarrow svarid\,isKW\,expLit
\end{align*}

绘制语句的定义
\begin{align*}
drawStmt &\rightarrow forExp\,listExp\,drawExp \\
forExp &\rightarrow forKW\,lmdVarId \\
listExp &\rightarrow fromKW\,expLit\,toKW\,expLit\,stepKW\,expLit \\
forKW\,lmdVarId,listExp,drawExp &\rightarrow forKW\,lmdVarId\,listExp\,drawKW\,expLmd
\end{align*}

关键字定义
\begin{align*}
isKW &\rightarrow \mathit{upper-lower\,uknown\,word\,is} \\
forKW &\rightarrow \mathit{upper-lower\,uknown\,word\,for} \\
fromKW &\rightarrow \mathit{upper-lower\,uknown\,word\,from} \\
toKW &\rightarrow \mathit{upper-lower\,uknown\,word\,to} \\
stepKW &\rightarrow \mathit{upper-lower\,uknown\,word\,step} \\
drawKW &\rightarrow \mathit{upper-lower\,uknown\,word\,draw}
\end{align*}

函数名定义
\begin{align*}
funcName &\rightarrow \mathit{the\,supported\,functions'\,names}
\end{align*}

非 $\lambda$ 表达式定义
\begin{align*}
expLit &\rightarrow expLitPS \\
expLitPS &\rightarrow expLitPS (+|-) expLitMD \\
expLitMD &\rightarrow expLitMD (\times|\div) expLitFunc | expLitFunc \\
expLitFunc &\rightarrow funcName'('expLitB')' | expLitB \\
expLitB &\rightarrow '('expLitPS')' | -expLitB | lit
\end{align*}

常量的定义
\begin{align*}
lit &\rightarrow float|decimal|octal|hexadecimal|tuple
\end{align*}
其中 tuple 是不能出现命名$\lambda$表达式的。

命名$\lambda$表达式
\begin{align*}
expLmd &\rightarrow expLmdPS \\
expLmdPS &\rightarrow expLmdPS (+|-) expLmdMD \\
expLmdMD &\rightarrow expLmdMD (\times|\div) expLmdFunc | expLmdFunc \\
expLmdFunc &\rightarrow funcName'('expLmdB')' | expLmdB \\
expLmdB &\rightarrow '('expLmdPS')' | -expLmdB | expLit | lmdVarId
\end{align*}

程序语法扩展定义
\begin{align*}
langOptItem &\rightarrow \mathit{defined\,language\,extension\,name}
\end{align*}

\section{语言与语法扩展}
\label{sec:languageextension}

\subsection{类与集合}
\label{sec:langexte:classNset}

这一部分是关于语言与语法扩展的关系。对于 $Uname$ （简记为 $U$） 类中的三个元素： UMK，UNK，与 UPK，相对的定一个类关于语法扩展：$Ext$。
然后对于这个内容，存在一系列的二元关系组成的集合 $ R \subseteq Uname \times Ext $。 这个二元关系是使得 UMK、UNK、与UPK
三者之间不完全的转换。举个例子，对于 注释的语法扩展，会使得 UNK 或 UPK 只能使用 UMK 中的语法格式，但不会是其他部分也与UMK 一样。
但是做一种变换，即认为，讨论某种语法扩展对于语言处于哪种集合的时候，只考虑很小的一部分源代码，也就是该扩展其作用的地方。
使得 我们的转换的二元关系的是完整的，也就是说“语言状态”由 UxK 转换成了UyK。

取一个语法扩展的子集 $E_u \subseteq Ext$ 与对应的 $R_u \subseteq R$ , 并定义两个映射 $source$ 与 $target$ ，均为
$ R_u \rightarrow U$ 其中含义是 二元关系（每个关系会对应一个语法扩展） 映射到 对应的原核集合 与变化核集合。
则 四元组 $<U,R_u,source,target>$ 组成了图，我们称之为语法扩展图。

我们定义一组特殊的二元关系 $R_\varepsilon$，对于 $ \forall x,y \in U$ 当对于某一语法或者语法扩展，$x$ 与 $y$ 是一样的，比如注释，
UNK 与 UPK 的注释是一样的，而与 UMK 不是一样的，则由二元关系 $r$ 满足从 x 到 由的转化，或者 $\widetilde{r}$ 满足 从 y 到 x 的转化。

则，对于一类语法扩展，额外再定义一个复合运算映射，则使得对于一类语法扩展组成的图与复合运算组成的 $<U,R_u,dom,cod,\circ>$ 五元组
形成一个范畴。则 $Ext$ 集合对应的语法扩展组成的一个范畴的集合。

% 包含两方面，扩展语言，与使得语言接近 编译原理原生的那个语言。也就是超集与子集。

\subsection{注释扩展}
\label{sec:langexte:comment}

在注释方面，UMK、UNK、与UPK 的注释策略大致不再相同。 UMK 的注释仅支持 C 或者是 Haskell 那样的 单行注释。而 UNK 相比UMK 则多了
C 或者是 Haskell 那样的 块注释。 然后 UPK 则将支持类似于 Hadock 那样的的注释扩展。

则有一个语法扩展的子集: CommentMini, CommentNormal, CommentDock, NoCommentMini, NoCommentNormal, NoCommentDock。
其中对于每个 CommentX 或者 NoCommentX 对应着一个变换。

\begin{tabular}{|c|c|c|c|c|c|c|}
  \hline 作用 & CommentMini & CommentNormal & CommentDock & NoCommentMini & NoCommentNormal & NoCommentDock \\
  \hline UMK & 默认开启 & 开启块注释 & 开启类Haddock注释 & 无意义（报警告）& 默认开启 & 默认开启 \\ 
  \hline UNK & 仅允许行注释 & 默认开启 & 开启类Haddock注释 & 无意义（报警告） & 关闭块注释 & 默认开启 \\
  \hline UPK & 仅允许行注释 & 仅允许行注释与块注释 & 默认开启 & 无意义（报警告） & 关闭块注释与注释扩展 & 关闭注释扩展 \\
  \hline 
\end{tabular}

\subsection{大小写扩展}
\label{sec:langexte:lettercase}



\end{document}
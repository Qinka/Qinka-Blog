# 中间代码设计

一般很多的的编译器都会分成前后端，前端与后端之间会有一种中间代码。然而这样分的实际原因是 许多中语言的前端会需要共用一个高效的后端。
常见的后端有 GCC 与 LLVM，但是 Uname 这个绘图语言，本身是不需要生成可执行代码的，但是还是需要绘图。而且绘图的后端打算采用多种种实现方式。
目前计划的使用 Haskell+GTK、Matlab 与 LaTeX 三种方式。所以目前的状况是三个绘制后端需要公用一个前端。

对于中间代码的话，应该是尽可能的简单。也就是基本连词法分析器都可以不要。所以尽可能长得想汇编。
用尽可能少的内容，将所要传递的内容在前后端之间传递。

## 中间代码设计考虑因素： UNIX 哲学

为什么要把 UNIX 哲学 放到第一位，没有原因。只是因为 UNIX 哲学之中的原则相对来说是更加适合着个东西的。
核心的 Unix 哲学的内容，所需要的是：让中间代码变成一种简单的文本格式，易于在前后端之间的传输与人为的辨识。
相对于二进制数据来说，更加容易读懂，同时最关键的是方便各种中间件的扩展。

所以中间代码的指令部分与数据部分都是按照文本格式设计。但是因为二进制文件还是有一定优势，所以，
还应该保留直接转换成二进制数据的能力与从二进制数据转换成文本文件的能力。


## 中间代码设计考虑因素： 扩展与兼容

考虑到兼容与扩展，比如说，我们要考虑扩展时间系。也就是说，我们需要添加帧概念，向渲染的后端传递每一帧。这与单纯传递一系列点的方式有一定区别，我们至少要传递区分每一帧的信息。

但是中间代码的可扩展性并不局限在中间代码设计方式。比如说，通过扩展的代码传递的方式来分别每一帧。

而考虑向后兼容的能力(也就是扩展性)的时候，旧的指令解析的程序，处理新的指令集中新的指令的时候
的策略是怎样的，是直接抛弃，还是终止。

同时扩展不能使得解析的难度有增加。解析的时候，无论是什么样的方式，扩展对解析带来的的开销提升，应该尽可能小。

## 中间代码设计考虑因素：与“底层”更接近